<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Petpetta 商品列表</title>
  <link rel="stylesheet" href="assets/styles.css" />
  <style>/* 省略原本 CSS ... */</style>
</head>
<body>
  <header>
    <h1 id="page-title">Petpetta 商品分類</h1>
    <nav><a href="index.html">回首頁</a></nav>
  </header>

  <section id="button-bar" style="text-align:center; padding:1rem;">
    <!-- 動態產生分類按鈕 -->
  </section>

  <section class="product-grid" id="product-list"></section>

  <footer><p>&copy; 2025 Petpetta 寵物生活館</p></footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    const firebaseConfig = { /* 填入專案資訊 */ };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const productList = document.getElementById("product-list");
    const buttonBar = document.getElementById("button-bar");
    const pageTitle = document.getElementById("page-title");
    const urlParams = new URLSearchParams(window.location.search);
    const type = urlParams.get("type");

    // 預設分類按鈕，將來也可改成從 Firestore 抓 category collection
    const categories = [
      { key: "狗狗專區", label: "🐶 狗狗專區" },
      { key: "貓咪專區", label: "🐱 貓咪專區" }
    ];
    categories.forEach(c => {
      const btn = document.createElement("button");
      btn.textContent = c.label;
      btn.style.margin = "0 0.5rem";
      btn.addEventListener("click", () => {
        location.search = `?type=${encodeURIComponent(c.key)}`;
      });
      buttonBar.appendChild(btn);
    });

    async function loadProducts(category) {
      productList.innerHTML = "";
      pageTitle.textContent = category ? `Petpetta｜${category}` : "Petpetta 商品分類";
      if (!category) {
        productList.innerHTML = '<div class="empty-message">請選擇上方分類或從首頁進入</div>';
        return;
      }

      const querySnapshot = await getDocs(collection(db, "products", category, "products"));
      if (querySnapshot.empty) {
        productList.innerHTML = '<div class="empty-message">目前此分類尚無商品</div>';
        return;
      }

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <img src="${data.image}" alt="${data.name}" />
          <h3>${data.name}</h3>
          <p>價格：${data.price} 元</p>
        `;
        productList.appendChild(card);
      });
    }

    loadProducts(type);
  </script>
</body>
</html>
